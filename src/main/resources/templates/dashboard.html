<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .sidebar {
            min-height: 100vh;
            background-color: #343a40;
            padding-top: 20px;
        }
        .sidebar .nav-link {
            color: #adb5bd;
            margin: 5px 15px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover {
            color: #fff;
            background-color: #495057;
        }
        .sidebar .nav-link.active {
            color: #fff;
            background-color: #007bff;
        }
        .main-content {
            padding: 20px;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .stats-card h3 {
            font-size: 2rem;
            font-weight: bold;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .navbar-brand {
            font-weight: bold;
            color: #343a40;
        }
        .quick-action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: white;
            transition: all 0.3s;
        }
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            color: white;
        }
        .icon-large {
            font-size: 3rem;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h5 class="text-white">维修管理系统</h5>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="/user/dashboard">
                                <i class="bi bi-house-door"></i> 控制台
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/category/manage">
                                <i class="bi bi-tags"></i> 分类管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/brand/manage">
                                <i class="bi bi-award"></i> 品牌管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/user/appointments">
                                <i class="bi bi-calendar-check"></i> 预约记录
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/user/login" onclick="return confirm('确定要退出吗？')">
                                <i class="bi bi-box-arrow-right"></i> 退出登录
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- 主内容区 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <!-- 顶部导航 -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">控制台</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
<!--                        <div class="btn-group me-2">-->
<!--                            <button type="button" class="btn btn-sm btn-outline-secondary">今日</button>-->
<!--                            <button type="button" class="btn btn-sm btn-outline-secondary">本周</button>-->
<!--                            <button type="button" class="btn btn-sm btn-outline-secondary">本月</button>-->
<!--                        </div>-->
                    </div>
                </div>

                <!-- 统计卡片 -->
                <div class="row">
                    <div class="col-xl-3 col-md-6">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6>总分类数</h6>
                                    <h3 id="categoryCount">--</h3>
                                    <span class="text-success"><i class="bi bi-arrow-up"></i></span>
                                </div>
                                <i class="bi bi-tags icon-large"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6>总品牌数</h6>
                                    <h3 id="brandCount">--</h3>
                                    <span class="text-success"><i class="bi bi-arrow-up"></i></span>
                                </div>
                                <i class="bi bi-award icon-large"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6>总预约数</h6>
                                    <h3 id="appointmentCount">--</h3>
                                    <span class="text-warning"><i class="bi bi-arrow-up"></i></span>
                                </div>
                                <i class="bi bi-calendar-check icon-large"></i>
                            </div>
                        </div>
                    </div>
<!--                    <div class="col-xl-3 col-md-6">-->
<!--                        <div class="stats-card">-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <div>-->
<!--                                    <h6>待处理预约</h6>-->
<!--                                    <h3 id="pendingCount">&#45;&#45;</h3>-->
<!--                                    <span class="text-danger"><i class="bi bi-exclamation-triangle"></i></span>-->
<!--                                </div>-->
<!--                                <i class="bi bi-clock icon-large"></i>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
                </div>

                <!-- 快捷操作 -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">快捷操作</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <a href="/category/manage" class="btn quick-action-btn w-100 p-3">
                                            <i class="bi bi-plus-lg d-block mb-2" style="font-size: 1.5rem;"></i>
                                            添加分类
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <a href="/brand/manage" class="btn quick-action-btn w-100 p-3">
                                            <i class="bi bi-plus-lg d-block mb-2" style="font-size: 1.5rem;"></i>
                                            添加品牌
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <a href="/user/appointments" class="btn quick-action-btn w-100 p-3">
                                            <i class="bi bi-eye d-block mb-2" style="font-size: 1.5rem;"></i>
                                            查看预约
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <button onclick="refreshData()" class="btn quick-action-btn w-100 p-3">
                                            <i class="bi bi-arrow-clockwise d-block mb-2" style="font-size: 1.5rem;"></i>
                                            刷新数据
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 近期预约 -->
<!--                <div class="row mt-4">-->
<!--                    <div class="col-12">-->
<!--                        <div class="card">-->
<!--                            <div class="card-header d-flex justify-content-between align-items-center">-->
<!--                                <h5 class="card-title mb-0">近期预约</h5>-->
<!--                                <a href="/user/appointments" class="btn btn-sm btn-outline-primary">查看全部</a>-->
<!--                            </div>-->
<!--                            <div class="card-body">-->
<!--                                <div class="table-responsive">-->
<!--                                    <table class="table table-striped">-->
<!--                                        <thead>-->
<!--                                            <tr>-->
<!--                                                <th>预约人</th>-->
<!--                                                <th>联系电话</th>-->
<!--                                                <th>预约时间</th>-->
<!--                                                <th>状态</th>-->
<!--                                                <th>地址</th>-->
<!--                                            </tr>-->
<!--                                        </thead>-->
<!--                                        <tbody id="recentAppointments">-->
<!--                                            <tr>-->
<!--                                                <td colspan="5" class="text-center text-muted">正在加载...</td>-->
<!--                                            </tr>-->
<!--                                        </tbody>-->
<!--                                    </table>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            loadDashboardData();
        });

        function loadDashboardData() {
            // 加载统计数据
            loadStatistics();
            // 加载近期预约
            // loadRecentAppointments();
        }

        function loadStatistics() {
            // 加载分类统计
            $.get('/category/list', function(response) {
                if (response.code === 200) {
                    $('#categoryCount').text(response.data.length);
                }
            }).fail(function() {
                $('#categoryCount').text('0');
            });

            // 加载品牌统计
            $.get('/brand/list', function(response) {
                if (response.code === 200) {
                    $('#brandCount').text(response.data.length);
                }
            }).fail(function() {
                $('#brandCount').text('0');
            });

            // 加载预约统计
            // 加载预约统计
            $.ajax({
                url: '/appoint/list',
                type: 'POST',
                contentType: 'application/json',  // 必须设置这个
                data: JSON.stringify({}),         // 空JSON对象
                success: function(response) {
                    if (response.code === 200) {
                        $('#appointmentCount').text(response.data.length);
                    } else {
                        $('#appointmentCount').text('0');
                    }
                },
                error: function() {
                    $('#appointmentCount').text('0');
                }
            });
        }

        function loadRecentAppointments() {
            // 这里可以添加获取近期预约的API调用
            var demoData = `
                <tr>
                    <td colspan="5" class="text-center text-muted">暂无预约记录</td>
                </tr>
            `;
            $('#recentAppointments').html(demoData);
        }

        function refreshData() {
            loadDashboardData();
            // 显示刷新成功提示
            var alert = $('<div class="alert alert-success alert-dismissible fade show" role="alert">' +
                         '数据已刷新 <button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>');
            $('.main-content').prepend(alert);
            setTimeout(function() {
                alert.alert('close');
            }, 3000);
        }
    </script>
</body>
</html>
